# AI Teacher Nexus 启动方式

## 端口配置总结

| 服务 | 端口 | 说明 |
|------|------|------|
| 前端 | 3000 | Next.js 应用 |
| 后端 | 8001 | 主服务 API |
| Docling 服务 | 8010 | 统一多模态服务 (文档/OCR/音频) |

前端端口：
默认: 3000（Next.js 默认）
设置位置: frontend/package.json - "dev": "next dev --turbopack -p 3000"
启动命令: npm run dev → 运行在 http://localhost:3000
后端端口：
当前: 8001
设置位置: src/server.py - port=8001
前端连接配置: frontend/.env.local - BACKEND_URL=http://127.0.0.1:8001
---

## 1. 主服务启动

### 后端服务
```bash
# 在项目根目录
.venv\Scripts\python.exe -m src.server
# 运行在 http://0.0.0.0:8001
```

### 前端服务
```bash
# 在 frontend 目录
cd frontend
npm run dev
# 运行在 http://localhost:3000
```

---

## 2. 多模态服务 (Docling) 启动

**注意：多模态服务不再随主服务自动启动，必须手动启动。**

### 第一步：初始化环境 (首次使用)
```bash
# 在项目根目录运行
.venv\Scripts\python.exe scripts/setup_services.py

# 验证环境是否正确
.venv\Scripts\python.exe scripts/setup_services.py --verify
```

### 第二步：启动服务
打开一个新的终端窗口，执行以下命令：

```bash
# 方式一：直接使用完整路径（推荐）
src\services\multimodal\docling\.venv\Scripts\python.exe src\services\multimodal\docling\server.py

# 方式二：进入目录运行
cd src\services\multimodal\docling
.venv\Scripts\python.exe server.py
```
服务将在 **http://127.0.0.1:8010** 启动。

### 第三步：验证服务
启动后，可以运行测试脚本验证服务是否正常响应：
```bash
# 在项目根目录
.venv\Scripts\python.exe scripts/test_multimodal_services.py
```

---

## 3. 完整开发流程

1. **启动多模态服务** (终端 1)
   ```bash
   src\services\multimodal\docling\.venv\Scripts\python.exe src\services\multimodal\docling\server.py
   ```

2. **启动后端主服务** (终端 2)
   ```bash
   .venv\Scripts\python.exe -m src.server
   ```

3. **启动前端** (终端 3)
   ```bash
   cd frontend
   npm run dev
   ```

### 访问地址
- 前端页面: http://localhost:3000
- 后端 API: http://localhost:8001
- Docling 服务: http://localhost:8010/health

---

## 4. 配置文件位置

| 配置项 | 文件路径 |
|--------|----------|
| 后端端口 | `src/server.py` - `port=8001` |
| 前端端口 | `frontend/package.json` - `"dev": "next dev -p 3000"` |
| Docling 连接配置 | `config/services.yaml` |

---

## 5. 多模态服务架构说明

```
src/services/multimodal/
├── __init__.py          # 模块入口
├── client.py            # 异步客户端
├── sync_client.py       # 同步客户端
└── docling/             # 统一多模态服务
    ├── .venv/           # 独立虚拟环境 (Python 3.11)
    ├── requirements.txt # 依赖列表
    └── server.py        # 服务入口
```

### 架构特点
- **统一服务**: 使用 Docling 处理文档和图片，集成 Whisper 处理音频。
- **独立环境**: 使用独立的 Python 3.11 虚拟环境，避免与主服务依赖冲突。
- **手动管理**: 服务生命周期完全手动管理，更稳定可控。
- **HTTP通信**: 主服务通过 HTTP 接口 (8010端口) 调用多模态能力。
